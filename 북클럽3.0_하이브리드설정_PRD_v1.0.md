# [PRD] 북클럽 3.0 하이브리드 설정 시스템

**프로젝트명**: Universal Settings
**문서 버전**: v2.0
**작성일**: 2025-02-10
**상태**: 🟢 Ready for Development

---

## 📋 목차

1. [개요 및 목적](#1-개요-및-목적)
2. [사용자 유형별 설정 정의](#2-사용자-유형별-설정-정의)
3. [핵심 기능 요구사항](#3-핵심-기능-요구사항)
4. [기술 및 운영 상세](#4-기술-및-운영-상세)
5. [장애 및 보안 시나리오](#5-장애-및-보안-시나리오)
6. [구현 가이드](#6-구현-가이드)

---

## 1. 개요 및 목적

### 1.1 배경

전용 패드(웅진 패드)와 개인 패드(BYOD) 환경이 공존함에 따라, **기기 유형에 따른 차별화된 설정 경험 제공** 필요.

**현재 문제점:**
- ❌ 전용 패드와 개인 패드의 설정 화면이 동일
- ❌ 기기 제어 메뉴가 개인 패드에서 작동하지 않음
- ❌ 개인 패드에서도 멤버십 연동 메뉴가 노출되어 혼란
- ❌ 자물쇠 보호가 모든 기기에 동일하게 적용

### 1.2 목적

1. ✅ **전용 패드: 통합 멤버십 경험 제공**
   - 기기 제어, 멤버십 연동, 자물쇠 보호
2. ✅ **개인 패드: 가벼운 독립 서비스 제공**
   - 콘텐츠 이용, 기본 학습, 간단한 설정

### 1.3 핵심 가치

```
🎯 하나의 앱, 두 가지 경험
   - 전용 패드: 웅진 통합 생태계 (프리미엄)
   - 개인 패드: 독립 구독 서비스 (스탠드얼론)
```

---

## 2. 사용자 유형별 설정 정의 (2-Tier Structure)

### 2.1 사용자 타입 분류

| 유형 | 식별 로직 | 가입 경로 | 주요 메뉴 구성 | 특징 |
|------|----------|----------|---------------|------|
| **전용 패드 회원** | `is_woongjin_device = true` | 패드 구매 + 통합 멤버십 | **Full-Set**<br>기기 제어 + 멤버십 연동 + 자물쇠 보호 | 웅진 생태계 통합<br>프리미엄 경험 |
| **개인 패드 회원** | `is_woongjin_device = false` | 홈페이지/앱 독립 구독 | **Light**<br>콘텐츠 이용 + 기본 학습 | 독립 서비스<br>연동 없음 |

---

### 2.2 메뉴 구성 상세

#### 전용 패드 회원 🏢

```
┌─────────────────────────────────────┐
│ ⚙️ 설정                             │
├─────────────────────────────────────┤
│                                     │
│ 🎨 북클럽 3.0 전용 기능             │
│   ✓ AI 독서 버디                    │
│   ✓ 시선 추적 시력 보호              │
│   ✓ 자동 재생                       │
│                                     │
│ 📱 기기 제어                        │
│   • 화면 밝기 (슬라이더)             │
│   • 음량 (슬라이더)                  │
│   • 블루라이트 필터 (토글)           │
│   • Wi-Fi (토글)                    │
│                                     │
│ 💎 멤버십 🔒                        │
│   • 포인트 통장 (1,250P)            │
│   • 구매 내역                       │
│   • 쿠폰함 (3장)                    │
│                                     │
│ 📚 학습 옵션 🔒                     │
│   • 학습 모드 (쉬움/보통/어려움)     │
│   • KRS 자동 조정 (토글)            │
│   • 학습 리포트                     │
│                                     │
│ 🔔 앱 설정                          │
│   • 알림 허용                       │
│   • 버전 정보                       │
│                                     │
│ 👤 계정 관리 🔒                     │
│   • 계정 정보                       │
│   • 멤버십 등급 (골드)              │
│   • 계정 탈퇴                       │
│                                     │
├─────────────────────────────────────┤
│ [🚪 로그아웃] [🏠 서비스 나가기 🔒] │
└─────────────────────────────────────┘
```

**하단 버튼:**
- 🚪 **로그아웃**: 계정에서 로그아웃
- 🏠 **서비스 나가기 🔒**: 북클럽 3.0 앱 종료 → 웅진 런처로 복귀 (비밀번호 필요)

**자물쇠 🔒 보호:**
- 목적: 아동의 무단 이탈 및 설정 변경 방지
- 대상: 멤버십, 학습 옵션, 계정 관리, 서비스 나가기
- 동작: 클릭 시 "보호자 비밀번호를 입력하세요" 팝업

---

#### 개인 패드 회원 👤

```
┌─────────────────────────────────────┐
│ ⚙️ 설정                             │
├─────────────────────────────────────┤
│                                     │
│ 🎨 북클럽 3.0 전용 기능             │
│   ✓ AI 독서 버디                    │
│   ✓ 시선 추적 시력 보호              │
│   ✓ 자동 재생                       │
│                                     │
│ [📱 기기 제어] ← 숨김               │
│ [💎 멤버십] ← 숨김                  │
│                                     │
│ 📚 학습 현황                        │
│   • 이번 주 독서: 3권               │
│   • 총 학습 시간: 2시간 30분        │
│                                     │
│ 🔔 앱 설정                          │
│   • 알림 허용                       │
│   • 버전 정보                       │
│                                     │
│ 👤 계정 관리                        │
│   • 계정 정보                       │
│   • 구독 관리                       │
│   • 계정 탈퇴                       │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│ 💡 전용 패드에서 더 많은 혜택을!    │
│ 포인트 적립, 구매 관리, 고급 학습   │
│ 분석 등을 이용하려면 전용 패드를    │
│ 구매하세요.                         │
│                                     │
│ [전용 패드 알아보기 →]              │
│                                     │
├─────────────────────────────────────┤
│         [🚪 로그아웃]               │
└─────────────────────────────────────┘
```

**하단 버튼:**
- 🚪 **로그아웃**: 계정에서 로그아웃 (단일 버튼)

**특징:**
- 자물쇠 없음 (부모 통제 불필요)
- 멤버십 연동 없음
- 전용 패드 유도 CTA 포함

---

## 3. 핵심 기능 요구사항 (Detailed Requirements)

### 3.1 다이내믹 메뉴 렌더링 (Dynamic UI)

#### 기기 제어 섹션

**노출 조건:** `is_woongjin_device = true`

**포함 기능:**
- 📱 **화면 밝기**: 0-100% 슬라이더, 안드로이드 시스템 API 호출
- 🔊 **음량**: 0-100% 슬라이더, 미디어/알림 볼륨 제어
- 🌙 **블루라이트 필터**: ON/OFF 토글, 색온도 조절
- 📶 **Wi-Fi**: 연결/해제 토글, 현재 SSID 표시

**기술 구현:**
```java
// Android 밝기 조절 예시
Settings.System.putInt(
  getContentResolver(),
  Settings.System.SCREEN_BRIGHTNESS,
  brightnessValue
);
```

---

#### 멤버십 섹션

**노출 조건:** `is_woongjin_device = true`

**포함 기능:**
- 💰 **포인트 통장**
  - 실시간 잔액 조회 (API: `/api/v1/points/balance`)
  - 적립/사용 내역 (최근 10건)
  - 소멸 예정 포인트 알림

- 📝 **구매 내역**
  - 지난 30일 구매 목록
  - 영수증 다운로드
  - 환불 요청 기능

- 🎁 **쿠폰함**
  - 사용 가능 쿠폰 목록
  - 쿠폰 등록 (코드 입력)
  - 유효기간 알림

**데이터 동기화:**
```
[웅진 통합 DB] ←→ [API] ←→ [북클럽 3.0 앱]
      ↓
  계정 기반 저장
  → 다른 웅진 서비스와 연동
```

**자물쇠 보호:**
```javascript
onClick={() => {
  showPasswordPrompt({
    title: '자녀 보호',
    message: '보호자 비밀번호를 입력하세요',
    onSuccess: (password) => {
      if (verifyParentPassword(password)) {
        navigateToMembership();
      } else {
        showError('비밀번호가 일치하지 않습니다');
      }
    }
  });
}}
```

---

### 3.2 학습 옵션 (Learning Options)

#### 전용 패드: 고급 학습 관리

**학습 모드:**
- 😊 **쉬움**: 기본 수준, 쉬운 콘텐츠 위주
- 😎 **보통**: 권장 수준, 균형잡힌 난이도
- 🤓 **어려움**: 도전 수준, 어려운 콘텐츠 우선

**KRS 자동 조정:**
```javascript
// 학습 모드 변경 시 KRS 엔진에 가중치 반영
onLearningModeChange(mode) {
  const weights = {
    easy: { krsOffset: -1, difficultyBias: 0.3 },
    standard: { krsOffset: 0, difficultyBias: 0.5 },
    hard: { krsOffset: +1, difficultyBias: 0.7 }
  };

  updateRecommendationEngine({
    krsLevel: user.krsLevel + weights[mode].krsOffset,
    difficultyBias: weights[mode].difficultyBias
  });
}
```

**자물쇠 보호:** 설정 변경 시 비밀번호 필요

---

#### 개인 패드: 기본 학습 통계

```javascript
// 간단한 학습 현황만 표시
getLearningStats() {
  return {
    weeklyBooks: 3,          // 이번 주 독서
    totalTime: '2h 30m',     // 총 학습 시간
    completedBooks: 12       // 완독 도서
  };
}
```

**특징:**
- 고급 KRS 연동 없음
- 자물쇠 보호 없음
- 간단한 통계만 제공

---

### 3.3 종료 UX (Exit Strategy)

#### 전용 패드: 서비스 나가기 🔒

**"서비스 나가기" 버튼:**
```java
// 북클럽 3.0 앱 종료 → 런처 복귀
public void exitToLauncher() {
  // 1. 비밀번호 확인
  if (!verifyParentPassword(inputPassword)) {
    showError("비밀번호가 일치하지 않습니다");
    return;
  }

  // 2. 현재 앱 종료
  finishAndRemoveTask();

  // 3. 런처 명시적 실행
  Intent launcherIntent = new Intent(Intent.ACTION_MAIN);
  launcherIntent.addCategory(Intent.CATEGORY_HOME);
  launcherIntent.setPackage("com.woongjin.launcher");
  launcherIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
  startActivity(launcherIntent);

  // 4. 프로세스 종료
  System.exit(0);
}
```

**UI 배치:**
```
┌─────────────────────────────────────┐
│  [🚪 로그아웃]  [🏠 서비스 나가기 🔒] │
│    (50% 너비)     (50% 너비)        │
└─────────────────────────────────────┘
```

---

#### 개인 패드: 로그아웃

**"로그아웃" 버튼:**
```javascript
// 표준 로그아웃 처리
function handleLogout() {
  // 1. 로컬 데이터 삭제
  clearLocalStorage();
  clearCache();

  // 2. 서버 세션 종료
  await fetch('/api/v1/auth/logout', { method: 'POST' });

  // 3. 로그인 화면으로 이동
  navigateTo('/login');
}
```

**UI 배치:**
```
┌─────────────────────────────────────┐
│        [🚪 로그아웃]                │
│         (100% 너비)                 │
└─────────────────────────────────────┘
```

---

## 4. 기술 및 운영 상세 (Technical Specs)

### 4.1 Device Sensing (기기 판별)

#### 방법 1: 단말기 모델명 확인

```kotlin
fun isWoongjinDevice(): Boolean {
  val deviceModel = Build.MODEL
  val deviceManufacturer = Build.MANUFACTURER

  return when {
    deviceModel.contains("WOONGJIN", ignoreCase = true) -> true
    deviceManufacturer.equals("Woongjin", ignoreCase = true) -> true
    else -> false
  }
}
```

#### 방법 2: 전용 런처 설치 여부

```kotlin
fun hasWoongjinLauncher(): Boolean {
  val pm = packageManager
  return try {
    pm.getPackageInfo("com.woongjin.launcher", 0)
    true
  } catch (e: PackageManager.NameNotFoundException) {
    false
  }
}
```

#### 최종 판별 로직

```kotlin
val isWoongjinDevice = isWoongjinDevice() || hasWoongjinLauncher()

val userType = if (isWoongjinDevice) {
  UserType.DEDICATED_PAD
} else {
  UserType.PERSONAL_DEVICE
}
```

---

### 4.2 Settings Persistence (설정 저장)

#### 저장 위치 전략

| 설정 유형 | 전용 패드 | 개인 패드 | 이유 |
|----------|----------|----------|------|
| **기기 설정**<br>(밝기, 음량 등) | SharedPreferences (로컬) | - | 기기 종속적 설정 |
| **멤버십 설정**<br>(포인트, 구매내역) | 서버 DB (웅진 통합) | - | 다른 서비스와 연동 |
| **학습 옵션** | 서버 DB + KRS 연동 | 로컬 DB | 전용 패드는 고급 연동 |
| **앱 설정** | 서버 DB + 로컬 캐시 | 로컬 DB | 사용자 경험 일관성 |

#### 구현 예시

```kotlin
// 전용 패드: 기기 설정 (로컬)
class DeviceSettingsRepository {
  private val prefs = context.getSharedPreferences("device_settings", MODE_PRIVATE)

  fun saveBrightness(value: Int) {
    prefs.edit().putInt("brightness", value).apply()
  }

  fun getBrightness(): Int {
    return prefs.getInt("brightness", 70)
  }
}

// 전용 패드: 멤버십 설정 (서버)
class MembershipSettingsRepository {
  suspend fun getPoints(userId: String): Points {
    // 웅진 통합 API 호출
    return api.getWoongjinPoints(userId)
  }
}

// 개인 패드: 기본 설정 (로컬)
class BasicSettingsRepository {
  private val prefs = context.getSharedPreferences("basic_settings", MODE_PRIVATE)

  fun saveLearningStats(stats: LearningStats) {
    prefs.edit()
      .putInt("weekly_books", stats.weeklyBooks)
      .putString("total_time", stats.totalTime)
      .apply()
  }
}
```

---

### 4.3 자물쇠 보호 시스템

#### 보호 대상 메뉴

```kotlin
// 전용 패드에서만 자물쇠 적용
val lockedMenus = if (isWoongjinDevice) {
  listOf(
    Menu.MEMBERSHIP,        // 멤버십 (포인트, 구매내역)
    Menu.LEARNING_OPTIONS,  // 학습 옵션
    Menu.ACCOUNT_MANAGE,    // 계정 관리
    Menu.SERVICE_EXIT       // 서비스 나가기
  )
} else {
  emptyList()  // 개인 패드는 자물쇠 없음
}
```

#### 비밀번호 검증

```kotlin
class ParentalLockManager {
  private val passwordHash = getStoredPasswordHash()

  fun verifyPassword(input: String): Boolean {
    val inputHash = hashPassword(input)
    return inputHash == passwordHash
  }

  fun showPasswordPrompt(onSuccess: () -> Unit) {
    showDialog {
      title = "자녀 보호"
      message = "보호자 비밀번호를 입력하세요"
      inputType = InputType.TYPE_TEXT_VARIATION_PASSWORD

      onPositiveButton("확인") { input ->
        if (verifyPassword(input)) {
          onSuccess()
        } else {
          showError("비밀번호가 일치하지 않습니다")
        }
      }

      onNegativeButton("취소")
    }
  }
}
```

#### 메뉴 클릭 처리

```kotlin
fun handleMenuClick(menu: Menu) {
  when {
    // 전용 패드 + 자물쇠 메뉴
    isWoongjinDevice && menu in lockedMenus -> {
      parentalLockManager.showPasswordPrompt {
        navigateTo(menu)
      }
    }

    // 일반 메뉴
    else -> {
      navigateTo(menu)
    }
  }
}
```

---

## 5. 장애 및 보안 시나리오

### 5.1 네트워크 단절 시

**문제 상황 (전용 패드):**
- 멤버십 메뉴(포인트 등) 진입 시 데이터 조회 불가

**대응 방안:**
```kotlin
try {
  val points = api.getPointsBalance()
  showPointsView(points)
} catch (e: NetworkException) {
  showOfflineMessage(
    "오프라인 상태입니다",
    "포인트 정보는 인터넷 연결 시 확인할 수 있어요."
  )
  // 진입 차단
  disablePointsMenu()
}
```

---

### 5.2 비밀번호 분실

**시나리오:**
- 부모가 자물쇠 비밀번호를 잊어버림

**대응 방안:**
```kotlin
// 비밀번호 초기화 플로우
fun resetParentPassword() {
  // 1. 고객센터 연결
  showDialog {
    title = "비밀번호 찾기"
    message = "고객센터(1588-xxxx)로 연락하여 본인 인증 후 초기화할 수 있습니다."

    onPositiveButton("전화하기") {
      val intent = Intent(Intent.ACTION_DIAL)
      intent.data = Uri.parse("tel:1588xxxx")
      startActivity(intent)
    }
  }
}
```

---

### 5.3 런처 복귀 실패

**시나리오:**
- "서비스 나가기" 시 런처 실행 실패

**대응 방안:**
```java
public void exitToLauncher() {
  try {
    // 1. 런처 명시적 실행 시도
    Intent launcherIntent = new Intent(Intent.ACTION_MAIN);
    launcherIntent.addCategory(Intent.CATEGORY_HOME);
    launcherIntent.setPackage("com.woongjin.launcher");
    startActivity(launcherIntent);
  } catch (ActivityNotFoundException e) {
    // 2. Fallback: 기본 홈 화면
    Intent homeIntent = new Intent(Intent.ACTION_MAIN);
    homeIntent.addCategory(Intent.CATEGORY_HOME);
    startActivity(homeIntent);
  } finally {
    // 3. 앱 종료
    finishAndRemoveTask();
    System.exit(0);
  }
}
```

---

## 6. 구현 가이드

### 6.1 컴포넌트 구조

```
SettingsActivity
├─ TypeSimulator (Dev Only)
├─ SettingsHeader
├─ SettingsContent
│  ├─ Bookclub3Section (공통)
│  ├─ DeviceControlSection (전용 패드만)
│  ├─ MembershipSection (전용 패드만 + 자물쇠)
│  ├─ LearningSection
│  │  ├─ AdvancedLearning (전용 패드 + 자물쇠)
│  │  └─ BasicLearning (개인 패드)
│  ├─ AppSettingsSection (공통)
│  └─ AccountSection
│     ├─ AdvancedAccount (전용 패드 + 자물쇠)
│     └─ BasicAccount (개인 패드)
└─ BottomButtons
   ├─ LogoutButton (공통)
   └─ ExitToLauncherButton (전용 패드만 + 자물쇠)
```

---

### 6.2 구현 체크리스트

#### Phase 1: 기본 구조 (1주)
- [ ] 사용자 타입 판별 로직 (전용 패드 vs 개인 패드)
- [ ] 2가지 타입별 화면 레이아웃
- [ ] 섹션별 조건부 렌더링

#### Phase 2: 기기 제어 (1주)
- [ ] 안드로이드 시스템 API 연동
- [ ] 밝기/음량 슬라이더
- [ ] 블루라이트 필터/Wi-Fi 토글

#### Phase 3: 멤버십 연동 (2주)
- [ ] 웅진 통합 API 연동
- [ ] 포인트 API 연동
- [ ] 구매 내역 조회
- [ ] 쿠폰 시스템

#### Phase 4: 자물쇠 보호 (1주)
- [ ] 비밀번호 입력 팝업
- [ ] 보호 메뉴 설정
- [ ] 비밀번호 검증 로직
- [ ] 실패 시 에러 처리
- [ ] 비밀번호 분실 처리

#### Phase 5: 종료 UX (1주)
- [ ] 서비스 나가기 (전용 패드)
- [ ] 서비스 나가기 자물쇠 보호
- [ ] 로그아웃 처리
- [ ] 세션 관리

#### Phase 6: 학습 옵션 (1주)
- [ ] 전용 패드: 고급 학습 모드 설정
- [ ] 전용 패드: KRS 엔진 연동
- [ ] 개인 패드: 기본 학습 통계

---

### 6.3 테스트 시나리오

#### 기능 테스트
```
1. 전용 패드 → 개인 패드 전환
   - 기기 제어 섹션 숨김 확인
   - 멤버십 섹션 숨김 확인
   - 자물쇠 아이콘 제거 확인
   - "서비스 나가기" 버튼 숨김 확인

2. 자물쇠 보호 (전용 패드)
   - 멤버십 클릭 → 비밀번호 팝업
   - 정확한 비밀번호 입력 → 접근 허용
   - 잘못된 비밀번호 입력 → 에러 메시지
   - 서비스 나가기 클릭 → 비밀번호 팝업

3. 네트워크 오류
   - 오프라인 시 멤버십 메뉴 진입 차단
   - 오프라인 메시지 표시

4. 로그아웃
   - 캐시 삭제 확인
   - UI 즉시 업데이트 확인
```

#### 성능 테스트
- 타입 전환 시 리렌더링 < 300ms
- API 응답 시간 < 500ms (p95)
- 메모리 사용량 < 100MB

---

## 📎 부록

### A. API 엔드포인트

```
# 웅진 통합 멤버십 (전용 패드만)
GET    /api/v1/woongjin/points/balance
GET    /api/v1/woongjin/purchases?days=30
GET    /api/v1/woongjin/coupons

# 학습 옵션
GET    /api/v1/learning/settings/:userId      # 전용 패드: 고급
PUT    /api/v1/learning/settings/:userId      # 전용 패드: 고급
GET    /api/v1/learning/stats/:userId         # 개인 패드: 기본

# 계정
POST   /api/v1/auth/logout
GET    /api/v1/user/info
DELETE /api/v1/user/account
```

---

### B. 디자인 가이드

**웅진 브랜드 컬러:**
```css
/* Primary */
--woongjin-orange: #FF8C42;
--woongjin-yellow: #FFB84D;
--woongjin-gold: #FFC837;

/* Gradient */
--woongjin-gradient: linear-gradient(135deg, #FF8C42 0%, #FFB84D 50%, #FFC837 100%);

/* Background */
--bg-soft: #FFF8F0;
--bg-light: #FFF4E6;
```

**컴포넌트 스타일:**
- 섹션 카드: `border-radius: 16px`, `shadow: 0 2px 8px rgba(0,0,0,0.1)`
- 토글: 52x28px, 웅진 그라데이션 (ON)
- 슬라이더: Track 8px, Thumb 20px, 웅진 그라데이션
- 자물쇠 아이콘: 16px, `#6B7280`

---

### C. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| v1.0 | 2025-02-10 | Claude | 초안 작성 (3-Tier) |
| v2.0 | 2025-02-10 | Claude | 2-Tier 구조로 단순화 |

---

**문서 상태**: 🟢 Ready for Development
**다음 단계**: Phase 1 기본 구조 구현 착수
**예상 완료일**: 2025-03-10 (4주)
