<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>ë¶í´ëŸ½ 3.0 í†µí•©ê²€ìƒ‰ ì‹œìŠ¤í…œ v1.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Apple SD Gothic Neo',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;-webkit-tap-highlight-color:transparent}
html,body,#root{width:100%;height:100%;overflow:hidden;background:#F8FAFC}

@keyframes slide-up{0%{transform:translateY(20px);opacity:0}100%{transform:translateY(0);opacity:1}}
@keyframes fade-in{0%{opacity:0}100%{opacity:1}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}

.anim-slide-up{animation:slide-up 0.3s ease-out both}
.anim-fade-in{animation:fade-in 0.2s ease-out both}
.search-result{transition:all 0.2s ease;border:2px solid transparent}
.search-result:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.1);border-color:#3B82F6}

.autocomplete-item{transition:all 0.15s ease}
.autocomplete-item:hover{background:#EFF6FF}
.autocomplete-item.active{background:#DBEAFE}

.filter-chip{transition:all 0.2s ease}
.filter-chip:hover{transform:scale(1.05)}

/* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
.custom-scroll::-webkit-scrollbar{width:8px;height:8px}
.custom-scroll::-webkit-scrollbar-track{background:#F1F5F9;border-radius:10px}
.custom-scroll::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:10px}
.custom-scroll::-webkit-scrollbar-thumb:hover{background:#94A3B8}

/* KRS ë ˆë²¨ ë°°ì§€ */
.krs-badge{
  display:inline-flex;
  align-items:center;
  padding:2px 8px;
  border-radius:12px;
  font-size:11px;
  font-weight:600;
}
.krs-1{background:#FEE2E2;color:#991B1B}
.krs-2{background:#FED7AA;color:#9A3412}
.krs-3{background:#FEF3C7;color:#92400E}
.krs-4{background:#D1FAE5;color:#065F46}
.krs-5{background:#DBEAFE;color:#1E40AF}

/* ë¡œë”© ìŠ¤í”¼ë„ˆ */
.spinner{
  border:3px solid #F1F5F9;
  border-top-color:#3B82F6;
  border-radius:50%;
  width:24px;
  height:24px;
  animation:spin 0.8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ì´ˆì„± í•˜ì´ë¼ì´íŠ¸ */
.chosung-highlight{
  background:linear-gradient(120deg,#FEF3C7 0%,#FDE68A 100%);
  padding:0 2px;
  border-radius:2px;
  font-weight:600;
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback,useMemo} = React;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” OpenSearchì—ì„œ ê°€ì ¸ì˜´)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SAMPLE_BOOKS = [
  {id:1, title:'ì‹ ë¹„ì•„íŒŒíŠ¸', author:'ì„œìš¸ë¬¸í™”ì‚¬', publisher:'ì„œìš¸ë¬¸í™”ì‚¬', genre:'ë§Œí™”', krsLevel:3, ageMin:7, ageMax:10, series:'ì‹ ë¹„ì•„íŒŒíŠ¸', cover:'ğŸ“š', rating:4.8, reviews:1234, popularity:95},
  {id:2, title:'ì‹ ë¹„í•œ ë§ˆë²•ì˜ ì„±', author:'ê¹€ë§ˆë²•', publisher:'ë§ˆë²•ì¶œíŒì‚¬', genre:'íŒíƒ€ì§€', krsLevel:3, ageMin:8, ageMax:11, series:null, cover:'ğŸ°', rating:4.5, reviews:567, popularity:78},
  {id:3, title:'ë˜ë´‡', author:'ë ˆíŠ¸ë¡œë´‡', publisher:'ì˜ì‹¤ì—…', genre:'ë§Œí™”', krsLevel:3, ageMin:5, ageMax:8, series:'ë˜ë´‡', cover:'ğŸ¤–', rating:4.7, reviews:890, popularity:88},
  {id:4, title:'íƒ€ìš” ë²„ìŠ¤', author:'ì•„ì´ì½”ë‹‰ìŠ¤', publisher:'í‚¤ì¦ˆëœë“œ', genre:'ë™í™”', krsLevel:2, ageMin:3, ageMax:6, series:'íƒ€ìš”', cover:'ğŸšŒ', rating:4.9, reviews:2345, popularity:92},
  {id:5, title:'ê³µë£¡ ëŒ€íƒí—˜', author:'ê¹€ê³µë£¡', publisher:'ê³¼í•™ë‚˜ë¼', genre:'ê³¼í•™', krsLevel:4, ageMin:9, ageMax:12, series:null, cover:'ğŸ¦•', rating:4.6, reviews:456, popularity:72},
  {id:6, title:'ì‹¬ì¿µ ë°”ë‹¤ ì—¬í–‰', author:'ì´ë°”ë‹¤', publisher:'ë°”ë‹¤ì¶œíŒ', genre:'ë™í™”', krsLevel:2, ageMin:4, ageMax:7, series:null, cover:'ğŸ ', rating:4.4, reviews:321, popularity:65},
  {id:7, title:'ëª¨í—˜ì™• íƒí—˜ëŒ€', author:'ë°•ëª¨í—˜', publisher:'íƒí—˜ì¶œíŒ', genre:'ëª¨í—˜', krsLevel:3, ageMin:8, ageMax:11, series:'ëª¨í—˜ì™•', cover:'ğŸ—ºï¸', rating:4.7, reviews:678, popularity:81},
  {id:8, title:'ìˆ²ì† ì¹œêµ¬ë“¤', author:'ìµœë‚˜ë¬´', publisher:'ìˆ²ì¶œíŒì‚¬', genre:'ë™í™”', krsLevel:2, ageMin:4, ageMax:7, series:null, cover:'ğŸŒ²', rating:4.8, reviews:543, popularity:76},
  {id:9, title:'ìš°ì£¼ íƒí—˜', author:'ê°•ìš°ì£¼', publisher:'ìš°ì£¼ê³¼í•™', genre:'ê³¼í•™', krsLevel:5, ageMin:10, ageMax:13, series:'ìš°ì£¼íƒí—˜', cover:'ğŸš€', rating:4.5, reviews:234, popularity:68},
  {id:10, title:'ë§ˆë²• í•™êµ', author:'ì •ë§ˆë²•', publisher:'ë§ˆë²•ì¶œíŒ', genre:'íŒíƒ€ì§€', krsLevel:4, ageMin:9, ageMax:12, series:'ë§ˆë²•í•™êµ', cover:'ğŸ§™', rating:4.9, reviews:1567, popularity:89},
  {id:11, title:'ì‹ ë¹„í•œ ë™ë¬¼ì›', author:'ì´ë™ë¬¼', publisher:'ë™ë¬¼ë‚˜ë¼', genre:'ë™í™”', krsLevel:3, ageMin:6, ageMax:9, series:null, cover:'ğŸ¦', rating:4.6, reviews:432, popularity:73},
  {id:12, title:'ë¡œë´‡ ì¹œêµ¬', author:'ê¹€ë¡œë´‡', publisher:'ë¡œë´‡ê³µí•™', genre:'ê³¼í•™', krsLevel:3, ageMin:7, ageMax:10, series:'ë¡œë´‡ì¹œêµ¬', cover:'ğŸ¤–', rating:4.7, reviews:765, popularity:82},
];

// ì´ˆì„± ì¶”ì¶œ í•¨ìˆ˜
const extractChosung = (str) => {
  const cho = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
  return str.split('').map(char => {
    const code = char.charCodeAt(0) - 0xAC00;
    if (code > -1 && code < 11172) return cho[Math.floor(code / 588)];
    return char;
  }).join('');
};

// ê²€ìƒ‰ ë§¤ì¹­ í•¨ìˆ˜ (ì´ˆì„±, ë¶€ë¶„ì¼ì¹˜, Fuzzy)
const matchSearch = (book, query) => {
  if (!query) return true;
  const q = query.toLowerCase();
  const title = book.title.toLowerCase();
  const author = book.author.toLowerCase();
  const chosung = extractChosung(book.title);

  // 1. ì œëª© ì •í™• ë§¤ì¹­
  if (title.includes(q)) return {match:true, score:100, type:'exact'};

  // 2. ì´ˆì„± ë§¤ì¹­
  if (chosung.includes(q)) return {match:true, score:80, type:'chosung'};

  // 3. ì €ì ë§¤ì¹­
  if (author.includes(q)) return {match:true, score:60, type:'author'};

  // 4. ë¶€ë¶„ ë§¤ì¹­ (2ê¸€ì ì´ìƒ)
  if (q.length >= 2) {
    for(let i = 0; i < title.length - 1; i++) {
      if (title.slice(i, i+q.length) === q) {
        return {match:true, score:70, type:'partial'};
      }
    }
  }

  // 5. Fuzzy ë§¤ì¹­ (ê°„ë‹¨í•œ Edit Distance)
  if (q.length >= 3 && editDistance(title, q) <= 2) {
    return {match:true, score:50, type:'fuzzy'};
  }

  return {match:false, score:0, type:null};
};

// ê°„ë‹¨í•œ Edit Distance (Levenshtein)
const editDistance = (a, b) => {
  const matrix = [];
  for(let i = 0; i <= b.length; i++) {
    matrix[i] = [i];
  }
  for(let j = 0; j <= a.length; j++) {
    matrix[0][j] = j;
  }
  for(let i = 1; i <= b.length; i++) {
    for(let j = 1; j <= a.length; j++) {
      if(b.charAt(i-1) === a.charAt(j-1)) {
        matrix[i][j] = matrix[i-1][j-1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i-1][j-1] + 1,
          matrix[i][j-1] + 1,
          matrix[i-1][j] + 1
        );
      }
    }
  }
  return matrix[b.length][a.length];
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë©”ì¸ ê²€ìƒ‰ ì»´í¬ë„ŒíŠ¸
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function SearchApp() {
  const [query, setQuery] = useState('');
  const [userKrs, setUserKrs] = useState(3);
  const [krsFilterOn, setKrsFilterOn] = useState(true);
  const [sortBy, setSortBy] = useState('relevance'); // relevance, latest, popular
  const [genreFilter, setGenreFilter] = useState('all');
  const [loading, setLoading] = useState(false);
  const [showAutocomplete, setShowAutocomplete] = useState(false);
  const [autocompleteIndex, setAutocompleteIndex] = useState(-1);
  const [searchHistory, setSearchHistory] = useState(['ì‹ ë¹„ì•„íŒŒíŠ¸', 'ë˜ë´‡']);

  const inputRef = useRef(null);

  // ê²€ìƒ‰ ê²°ê³¼ ê³„ì‚°
  const searchResults = useMemo(() => {
    if (!query && genreFilter === 'all') {
      // ì´ˆê¸° í™”ë©´: ì¸ê¸° ë„ì„œ
      return SAMPLE_BOOKS
        .sort((a,b) => b.popularity - a.popularity)
        .slice(0, 12);
    }

    // ê²€ìƒ‰ì–´ ë§¤ì¹­
    let results = SAMPLE_BOOKS
      .map(book => ({
        ...book,
        matchInfo: matchSearch(book, query)
      }))
      .filter(book => book.matchInfo.match);

    // ì¥ë¥´ í•„í„°
    if (genreFilter !== 'all') {
      results = results.filter(book => book.genre === genreFilter);
    }

    // KRS í•„í„°
    if (krsFilterOn) {
      results = results.filter(book =>
        book.krsLevel >= userKrs - 1 && book.krsLevel <= userKrs + 1
      );
    }

    // KRS ë¶€ìŠ¤íŒ… ìŠ¤ì½”ì–´ ê³„ì‚°
    results = results.map(book => {
      let finalScore = book.matchInfo.score;

      // KRS ë ˆë²¨ ë¶€ìŠ¤íŒ…
      if (book.krsLevel === userKrs) {
        finalScore *= 2.0; // ì •í™• ë§¤ì¹­
      } else if (Math.abs(book.krsLevel - userKrs) === 1) {
        finalScore *= 1.5; // Â±1 ë²”ìœ„
      }

      // ì¸ê¸°ë„ ê°€ì¤‘ì¹˜
      finalScore += book.popularity * 0.1;

      return {...book, finalScore};
    });

    // ì •ë ¬
    if (sortBy === 'relevance') {
      results.sort((a,b) => b.finalScore - a.finalScore);
    } else if (sortBy === 'latest') {
      results.sort((a,b) => b.id - a.id);
    } else if (sortBy === 'popular') {
      results.sort((a,b) => b.popularity - a.popularity);
    }

    return results;
  }, [query, userKrs, krsFilterOn, sortBy, genreFilter]);

  // ìë™ì™„ì„± ì œì•ˆ
  const autocompleteSuggestions = useMemo(() => {
    if (!query || query.length < 1) return [];

    const suggestions = SAMPLE_BOOKS
      .map(book => {
        const match = matchSearch(book, query);
        return match.match ? {title: book.title, type: match.type, score: match.score} : null;
      })
      .filter(Boolean)
      .sort((a,b) => b.score - a.score)
      .slice(0, 5);

    return suggestions;
  }, [query]);

  // ê²€ìƒ‰ ì‹¤í–‰
  const handleSearch = (searchQuery) => {
    setLoading(true);
    setShowAutocomplete(false);

    // ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ì¶”ê°€
    if (searchQuery && !searchHistory.includes(searchQuery)) {
      setSearchHistory(prev => [searchQuery, ...prev].slice(0, 5));
    }

    setTimeout(() => setLoading(false), 300);
  };

  // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
  const handleKeyDown = (e) => {
    if (e.key === 'Enter') {
      if (autocompleteIndex >= 0 && autocompleteSuggestions[autocompleteIndex]) {
        const selected = autocompleteSuggestions[autocompleteIndex].title;
        setQuery(selected);
        handleSearch(selected);
      } else {
        handleSearch(query);
      }
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      setAutocompleteIndex(prev =>
        Math.min(prev + 1, autocompleteSuggestions.length - 1)
      );
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      setAutocompleteIndex(prev => Math.max(prev - 1, -1));
    } else if (e.key === 'Escape') {
      setShowAutocomplete(false);
    }
  };

  return (
    <div className="w-full h-full flex flex-col bg-gradient-to-br from-blue-50 via-white to-purple-50">
      {/* í—¤ë” */}
      <div className="shrink-0 bg-white shadow-sm border-b border-gray-200">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="text-2xl">ğŸ”</div>
              <div>
                <h1 className="text-xl font-black text-gray-800">ë¶í´ëŸ½ 3.0 í†µí•©ê²€ìƒ‰</h1>
                <p className="text-xs text-gray-500">ì‹¤ì‹œê°„ ì¸ë±ì‹± Â· KRS ê°œì¸í™” Â· ì´ˆì„± ê²€ìƒ‰</p>
              </div>
            </div>

            {/* ì‚¬ìš©ì KRS ë ˆë²¨ ì„ íƒ */}
            <div className="flex items-center gap-2 text-sm">
              <span className="text-gray-600">ë‚´ ë…ì„œ ë ˆë²¨:</span>
              <select
                value={userKrs}
                onChange={(e) => setUserKrs(Number(e.target.value))}
                className="px-3 py-1.5 border border-gray-300 rounded-lg font-semibold text-blue-600 bg-white cursor-pointer"
              >
                {[1,2,3,4,5].map(level => (
                  <option key={level} value={level}>KRS Lv.{level}</option>
                ))}
              </select>
            </div>
          </div>

          {/* ê²€ìƒ‰ ë°” */}
          <div className="mt-4 relative">
            <div className="relative">
              <input
                ref={inputRef}
                type="text"
                value={query}
                onChange={(e) => {
                  setQuery(e.target.value);
                  setShowAutocomplete(true);
                  setAutocompleteIndex(-1);
                }}
                onFocus={() => setShowAutocomplete(true)}
                onKeyDown={handleKeyDown}
                placeholder="ì œëª©, ì €ì, ì´ˆì„±ìœ¼ë¡œ ê²€ìƒ‰ (ì˜ˆ: ì‹ ë¹„ì•„íŒŒíŠ¸, ã……ã…‚ã…‡ã…ã…Œ)"
                className="w-full px-5 py-4 pr-32 text-lg border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-blue-500 transition-all"
              />
              <div className="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2">
                {query && (
                  <button
                    onClick={() => {setQuery(''); inputRef.current?.focus()}}
                    className="text-gray-400 hover:text-gray-600 text-xl"
                  >
                    âœ•
                  </button>
                )}
                <button
                  onClick={() => handleSearch(query)}
                  className="px-5 py-2 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 active:scale-95 transition-all"
                >
                  ê²€ìƒ‰
                </button>
              </div>
            </div>

            {/* ìë™ì™„ì„± */}
            {showAutocomplete && query && autocompleteSuggestions.length > 0 && (
              <div className="absolute top-full mt-2 w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden z-50 anim-slide-up">
                {autocompleteSuggestions.map((sugg, idx) => (
                  <div
                    key={idx}
                    className={`autocomplete-item px-5 py-3 cursor-pointer flex items-center justify-between ${idx === autocompleteIndex ? 'active' : ''}`}
                    onClick={() => {
                      setQuery(sugg.title);
                      handleSearch(sugg.title);
                    }}
                  >
                    <div className="flex items-center gap-2">
                      <span className="text-gray-400">ğŸ”</span>
                      <span className="font-medium text-gray-800">{sugg.title}</span>
                    </div>
                    <span className="text-xs text-gray-400">
                      {sugg.type === 'exact' && 'ì •í™•'}
                      {sugg.type === 'chosung' && 'ì´ˆì„±'}
                      {sugg.type === 'author' && 'ì €ì'}
                      {sugg.type === 'partial' && 'ë¶€ë¶„'}
                      {sugg.type === 'fuzzy' && 'ìœ ì‚¬'}
                    </span>
                  </div>
                ))}
              </div>
            )}

            {/* ìµœê·¼ ê²€ìƒ‰ì–´ */}
            {showAutocomplete && !query && searchHistory.length > 0 && (
              <div className="absolute top-full mt-2 w-full bg-white rounded-xl shadow-lg border border-gray-200 p-3 z-50 anim-slide-up">
                <div className="text-xs text-gray-500 mb-2 font-semibold">ìµœê·¼ ê²€ìƒ‰ì–´</div>
                <div className="flex flex-wrap gap-2">
                  {searchHistory.map((term, idx) => (
                    <button
                      key={idx}
                      onClick={() => {
                        setQuery(term);
                        handleSearch(term);
                      }}
                      className="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 transition-all"
                    >
                      ğŸ•’ {term}
                    </button>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* í•„í„° ë° ì˜µì…˜ */}
          <div className="mt-4 flex items-center justify-between flex-wrap gap-3">
            {/* KRS í•„í„° í† ê¸€ */}
            <label className="flex items-center gap-2 cursor-pointer group">
              <input
                type="checkbox"
                checked={krsFilterOn}
                onChange={(e) => setKrsFilterOn(e.target.checked)}
                className="w-5 h-5 cursor-pointer"
              />
              <span className="text-sm font-semibold text-gray-700 group-hover:text-blue-600 transition-colors">
                ğŸ‘¶ ìš°ë¦¬ ì•„ì´ ìˆ˜ì¤€ì— ë§ëŠ” ë„ì„œë§Œ ë³´ê¸° (KRS Lv.{userKrs} Â±1)
              </span>
            </label>

            {/* ì¥ë¥´ í•„í„° */}
            <div className="flex items-center gap-2 flex-wrap">
              {['all', 'ë§Œí™”', 'ë™í™”', 'ê³¼í•™', 'íŒíƒ€ì§€', 'ëª¨í—˜'].map(genre => (
                <button
                  key={genre}
                  onClick={() => setGenreFilter(genre)}
                  className={`filter-chip px-3 py-1 rounded-full text-sm font-medium ${
                    genreFilter === genre
                      ? 'bg-blue-500 text-white'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {genre === 'all' ? 'ì „ì²´' : genre}
                </button>
              ))}
            </div>

            {/* ì •ë ¬ */}
            <select
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value)}
              className="px-3 py-1.5 border border-gray-300 rounded-lg text-sm bg-white cursor-pointer"
            >
              <option value="relevance">ê´€ë ¨ë„ìˆœ</option>
              <option value="latest">ìµœì‹ ìˆœ</option>
              <option value="popular">ì¸ê¸°ìˆœ</option>
            </select>
          </div>
        </div>
      </div>

      {/* ê²€ìƒ‰ ê²°ê³¼ */}
      <div className="flex-1 overflow-y-auto custom-scroll">
        <div className="max-w-7xl mx-auto px-4 py-6">
          {/* ê²°ê³¼ í—¤ë” */}
          <div className="mb-4 flex items-center justify-between">
            <div className="text-sm text-gray-600">
              {loading ? (
                <div className="flex items-center gap-2">
                  <div className="spinner"></div>
                  <span>ê²€ìƒ‰ ì¤‘...</span>
                </div>
              ) : (
                <span>
                  ê²€ìƒ‰ ê²°ê³¼ <span className="font-bold text-blue-600">{searchResults.length}</span>ê¶Œ
                  {query && <span className="ml-2 text-gray-400">"{query}"</span>}
                </span>
              )}
            </div>
          </div>

          {/* ê²°ê³¼ ì—†ìŒ */}
          {!loading && searchResults.length === 0 && query && (
            <div className="text-center py-12 anim-slide-up">
              <div className="text-6xl mb-4">ğŸ˜¢</div>
              <h3 className="text-xl font-bold text-gray-800 mb-2">
                "{query}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
              </h3>
              <p className="text-gray-500 mb-6">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”</p>

              <div className="mt-8 max-w-4xl mx-auto">
                <h4 className="text-lg font-bold text-gray-700 mb-4">
                  ğŸ¯ ì´ëŸ° ë„ì„œëŠ” ì–´ë•Œìš”? (ìš°ë¦¬ ì•„ì´ ìˆ˜ì¤€ì— ë§ì¶°ìš”!)
                </h4>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                  {SAMPLE_BOOKS
                    .filter(b => b.krsLevel >= userKrs - 1 && b.krsLevel <= userKrs + 1)
                    .sort((a,b) => b.popularity - a.popularity)
                    .slice(0, 6)
                    .map(book => (
                      <BookCard key={book.id} book={book} userKrs={userKrs} highlight={false} />
                    ))}
                </div>
              </div>
            </div>
          )}

          {/* ê²°ê³¼ ê·¸ë¦¬ë“œ */}
          {!loading && searchResults.length > 0 && (
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              {searchResults.map((book, idx) => (
                <div
                  key={book.id}
                  className="anim-slide-up"
                  style={{animationDelay: `${idx * 0.05}s`}}
                >
                  <BookCard
                    book={book}
                    userKrs={userKrs}
                    highlight={query}
                    matchType={book.matchInfo?.type}
                  />
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* í‘¸í„° */}
      <div className="shrink-0 bg-white border-t border-gray-200 px-4 py-3">
        <div className="max-w-7xl mx-auto text-xs text-gray-500 text-center">
          ğŸš€ ì‹¤ì‹œê°„ ì¸ë±ì‹± Â· OpenSearch ê¸°ë°˜ Â· Nori í˜•íƒœì†Œ ë¶„ì„ Â· KRS ê°œì¸í™” ë­í‚¹ ì—”ì§„
          <span className="ml-3 text-blue-500 font-semibold">v1.0 Prototype</span>
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë„ì„œ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function BookCard({book, userKrs, highlight, matchType}) {
  const isMatchedLevel = book.krsLevel === userKrs;
  const isNearLevel = Math.abs(book.krsLevel - userKrs) === 1;

  // ì œëª© í•˜ì´ë¼ì´íŠ¸
  const highlightTitle = (title) => {
    if (!highlight) return title;
    const idx = title.toLowerCase().indexOf(highlight.toLowerCase());
    if (idx === -1) return title;

    return (
      <>
        {title.slice(0, idx)}
        <span className="chosung-highlight">{title.slice(idx, idx + highlight.length)}</span>
        {title.slice(idx + highlight.length)}
      </>
    );
  };

  return (
    <div className="search-result bg-white rounded-xl p-4 shadow-sm cursor-pointer group">
      {/* í‘œì§€ */}
      <div className="relative mb-3">
        <div className="aspect-[3/4] bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center text-6xl group-hover:scale-105 transition-transform">
          {book.cover}
        </div>

        {/* KRS ë ˆë²¨ ë°°ì§€ */}
        <div className={`absolute top-2 left-2 krs-badge krs-${book.krsLevel}`}>
          KRS {book.krsLevel}
        </div>

        {/* ë§¤ì¹­ íƒ€ì… ë°°ì§€ */}
        {matchType && (
          <div className="absolute top-2 right-2 bg-yellow-400 text-yellow-900 px-2 py-0.5 rounded-full text-[10px] font-bold">
            {matchType === 'exact' && 'ì •í™•'}
            {matchType === 'chosung' && 'ì´ˆì„±'}
            {matchType === 'author' && 'ì €ì'}
            {matchType === 'partial' && 'ë¶€ë¶„'}
            {matchType === 'fuzzy' && 'ìœ ì‚¬'}
          </div>
        )}

        {/* KRS ë§¤ì¹­ í‘œì‹œ */}
        {isMatchedLevel && (
          <div className="absolute bottom-2 right-2 bg-blue-500 text-white px-2 py-1 rounded-lg text-[10px] font-bold">
            â­ ë”± ë§ì•„ìš”!
          </div>
        )}
        {isNearLevel && (
          <div className="absolute bottom-2 right-2 bg-green-500 text-white px-2 py-1 rounded-lg text-[10px] font-bold">
            ğŸ‘ ì¶”ì²œí•´ìš”
          </div>
        )}
      </div>

      {/* ì •ë³´ */}
      <div>
        <h3 className="font-bold text-gray-800 text-sm mb-1 line-clamp-2 group-hover:text-blue-600 transition-colors">
          {highlightTitle(book.title)}
        </h3>
        <p className="text-xs text-gray-500 mb-2">{book.author}</p>

        <div className="flex items-center justify-between text-xs">
          <div className="flex items-center gap-1 text-yellow-500">
            â­ {book.rating.toFixed(1)}
          </div>
          <div className="text-gray-400">
            {book.reviews.toLocaleString()} ë¦¬ë·°
          </div>
        </div>

        {book.series && (
          <div className="mt-2 text-[10px] text-blue-600 font-medium">
            ğŸ“š {book.series} ì‹œë¦¬ì¦ˆ
          </div>
        )}
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë Œë”ë§
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
ReactDOM.createRoot(document.getElementById('root')).render(<SearchApp />);
</script>
</body>
</html>
