# 북클럽 3.0 통합뷰어 정책 문서 v0.2

> 최종 수정일: 2025-02-06
> 버전: v0.2

---

## 1. 개요

### 1.1 목적
북클럽 3.0 통합뷰어는 유아/초등 저학년 대상 독서 학습 플랫폼에서 다양한 콘텐츠(도서, 영상, 놀이학습)를 통합적으로 제공하기 위한 뷰어 엔진입니다.

### 1.2 대상 플랫폼
| 플랫폼 | 지원 여부 | 비고 |
|--------|----------|------|
| 태블릿 (iPad, Android) | ✅ 주요 타겟 | 터치 인터랙션 최적화 |
| PC (Chrome, Edge) | ✅ 지원 | 마우스 드래그 지원 |
| 모바일 (스마트폰) | ⚠️ 제한적 | 화면 크기 제약 |

### 1.3 기술 스택
- **프론트엔드**: React 18 (CDN), Tailwind CSS
- **PDF 렌더링**: pdf.js 3.11.174
- **빌드**: 단일 HTML 파일 (빌드 도구 불필요)
- **저장소**: localStorage (감상문 데이터)

---

## 2. 뷰어 모드

### 2.1 도서 뷰어 (PDF)

#### 2.1.1 기본 기능
| 기능 | 설명 | 조작 방법 |
|------|------|----------|
| 페이지 넘기기 | 이전/다음 페이지 이동 | 스와이프, 화살표 버튼, 키보드 ←→ |
| 단면 보기 | 한 페이지씩 표시 | 툴바에서 "단면" 선택 |
| 양면 보기 | 두 페이지 펼쳐보기 | 툴바에서 "양면" 선택 |
| 자동 재생 | 설정 간격으로 자동 넘김 | 2초/3초/5초/8초 선택 |

#### 2.1.2 UI 표시 정책
- **기본 상태**: UI 메뉴 표시
- **드래그/스와이프 시작**: UI 자동 숨김
- **화면 탭/클릭**: UI 토글 (표시/숨김)
- **페이지 전환 후**: UI 숨김 상태 유지

#### 2.1.3 감상문 기능
| 기능 | 설명 |
|------|------|
| 전체화면 저장 | 현재 페이지를 PNG 이미지로 다운로드 |
| 감상문 쓰기 | 글쓰기 + 꾸미기(그리기/사진) 도구 |
| 감상문 보기 | 저장된 감상문 갤러리 |

#### 2.1.4 감상문 저장 정책
- **저장 위치**: localStorage (`bookclub3_reports` 키)
- **저장 형식**: JSON 배열 (base64 썸네일 포함)
- **데이터 항목**: id, bookName, title, bodyText, photos, drawingData, thumbnail, createdAt, updatedAt

### 2.2 영상 뷰어

#### 2.2.1 기본 기능
| 기능 | 설명 |
|------|------|
| 자동 재생 | 진입 시 자동 재생 시작 |
| 재생/일시정지 | 중앙 버튼 또는 화면 탭 |
| 구간 이동 | ±10초 버튼, 프로그레스 바 탭 |
| 재생 속도 | 0.5x / 1.0x / 1.5x / 2.0x |
| 전체 화면 | 전체 화면 모드 전환 |

#### 2.2.2 UI 표시 정책
- 화면 탭 시 UI 토글
- 일정 시간 무조작 시 UI 자동 숨김 (향후 구현)

### 2.3 놀이학습 뷰어 (인터랙티브)

#### 2.3.1 활동 유형
| 유형 | 설명 | 보상 별 |
|------|------|--------|
| 인트로 | 활동 안내 페이지 | 0개 |
| 드래그앤드롭 | 아이템을 목표 위치로 이동 | 3개 |
| 색칠하기 | 펜/채우기 도구로 그림 색칠 | 2개 |
| 선긋기 | 짝 맞추기 (단어↔그림 연결) | 3개 |
| 카메라 | 사진 촬영 후 액자에 넣기 | 2개 |

#### 2.3.2 인터랙션 정책
| 항목 | 정책 |
|------|------|
| 입력 방식 | Pointer Events API (터치/마우스 통합) |
| 정답 판정 | 드래그: 목표 영역 15% 이내, 선긋기: 40px 이내 |
| 오답 피드백 | 원위치 복귀 또는 빨간선 표시 후 사라짐 |
| 완료 처리 | 모든 항목 완료 시 별 보상 오버레이 |

#### 2.3.3 그리기 도구 정책
| 도구 | 동작 |
|------|------|
| 펜 | 자유 곡선 그리기, 굵기 조절 가능 (2~20px) |
| 채우기 | Flood-fill 알고리즘, tolerance 40 |
| 지우개 | 배경색으로 덮어쓰기, 펜 굵기 3배 |
| 되돌리기 | 히스토리 스택 (최대 30단계) |

#### 2.3.4 카메라 정책
- **우선 카메라**: 후면 카메라 (facingMode: environment)
- **해상도**: 640x480 (ideal)
- **미지원 시**: 샘플 이모지 이미지 선택 폴백
- **출력 형식**: JPEG (품질 0.85)

---

## 3. 공통 정책

### 3.1 좌표계
- 모든 위치값은 **퍼센트(%)** 기반으로 저장
- 반응형 레이아웃 대응

### 3.2 HiDPI 대응
- Canvas 렌더링 시 `devicePixelRatio` 적용
- 물리 픽셀 기준 렌더링 후 CSS로 논리 크기 조정

### 3.3 성능 최적화
| 항목 | 방법 |
|------|------|
| PDF 렌더링 | 현재 페이지만 렌더링, 이전 태스크 취소 |
| 이미지 저장 | 썸네일 별도 생성 (품질 0.15) |
| Canvas 히스토리 | 최대 30개 유지, 초과 시 오래된 것 삭제 |

### 3.4 접근성
- 터치 타겟 최소 44x44px 권장
- 색상 대비 준수 (텍스트/배경)
- 키보드 네비게이션 지원 (도서 뷰어)

---

## 4. 데이터 구조

### 4.1 감상문 (Report)
```javascript
{
  id: string,           // 고유 ID (timestamp + random)
  bookName: string,     // 도서명
  title: string,        // 감상문 제목
  bodyText: string,     // 본문 텍스트
  photos: [             // 첨부 사진 배열
    {
      id: string,
      src: string,      // base64 data URL
      x: number,        // 위치 % (0-100)
      y: number,
      w: number,        // 크기 % (0-100)
      h: number
    }
  ],
  drawingData: string,  // 캔버스 그리기 데이터 (base64)
  thumbnail: string,    // 썸네일 (base64, 저품질)
  createdAt: string,    // ISO 8601
  updatedAt: string     // ISO 8601
}
```

### 4.2 놀이학습 상태
```javascript
{
  completed: Set<number>,  // 완료한 페이지 ID
  currentPage: number,     // 현재 페이지 (1-based)
  totalStars: number       // 획득한 총 별 개수
}
```

---

## 5. 버전 히스토리

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v0.1 | 2025-02-06 | 초기 프로토타입 릴리즈 |
| v0.2 | 2025-02-06 | 샘플 PDF 도서 추가, 파일 구조 정리 |

---

## 6. 향후 계획

### 6.1 단기 (v0.3)
- [ ] 실제 영상 파일 재생 지원
- [ ] 놀이학습 콘텐츠 JSON 외부화
- [ ] 오프라인 저장 (IndexedDB)

### 6.2 중기 (v1.0)
- [ ] 서버 연동 (감상문 동기화)
- [ ] 학습 진도 추적
- [ ] 다국어 지원

### 6.3 장기
- [ ] AI 기반 학습 피드백
- [ ] 음성 인식 연동
- [ ] 학부모/교사 대시보드

---

## 7. 파일 구조

```
북클럽3.0_통합뷰어/
├── prototype/
│   ├── 북클럽3.0_통합뷰어_v0.1.html         # v0.1 뷰어
│   ├── 북클럽3.0_통합뷰어_v0.2.html         # v0.2 뷰어 (최신)
│   ├── 북클럽3.0_통합뷰어_정책문서_v0.1.md  # v0.1 정책문서
│   └── 북클럽3.0_통합뷰어_정책문서_v0.2.md  # v0.2 정책문서 (본 문서)
├── 샘플도서/
│   └── 9789814983754_Scholastic_3 Cats.pdf  # 샘플 PDF 도서
└── README.md
```

---

## 8. 연락처

- **저장소 (GitHub)**: https://github.com/g10016775-cpu/junghwan
- **저장소 (WJTB)**: https://git.wjtb.kr/ai-labs/bookclub30/bc3_int_viewer
