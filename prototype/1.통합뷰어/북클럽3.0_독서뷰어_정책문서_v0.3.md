# 북클럽 3.0 독서뷰어 정책 문서 v0.3

> 최종 수정일: 2025-02-10
> 버전: v0.3

---

## 1. 개요

### 1.1 목적
북클럽 3.0 독서뷰어는 유아/초등 저학년 대상 독서 학습 플랫폼에서 PDF 도서 콘텐츠를 AI 버디와 함께 읽을 수 있는 전용 뷰어입니다.

### 1.2 대상 플랫폼
| 플랫폼 | 지원 여부 | 비고 |
|--------|----------|------|
| 태블릿 (iPad, Android) | ✅ 주요 타겟 | 터치 인터랙션 최적화 |
| PC (Chrome, Edge) | ✅ 지원 | 마우스 드래그 지원 |
| 모바일 (스마트폰) | ⚠️ 제한적 | 화면 크기 제약 |

### 1.3 기술 스택
- **프론트엔드**: React 18 (CDN), Tailwind CSS
- **PDF 렌더링**: pdf.js 3.11.174
- **빌드**: 단일 HTML 파일 (빌드 도구 불필요)
- **저장소**: localStorage (감상문 데이터)

---

## 2. 뷰어 모드

### 2.1 도서 뷰어 (PDF)

#### 2.1.1 기본 기능
| 기능 | 설명 | 조작 방법 |
|------|------|----------|
| 페이지 넘기기 | 이전/다음 페이지 이동 | 스와이프, 화살표 버튼, 키보드 ←→ |
| 단면 보기 | 한 페이지씩 표시 | 툴바에서 "단면" 선택 |
| 양면 보기 | 두 페이지 펼쳐보기 | 툴바에서 "양면" 선택 |
| 자동 재생 | 설정 간격으로 자동 넘김 | 2초/3초/5초/8초 선택 |

#### 2.1.2 UI 표시 정책
- **기본 상태**: UI 메뉴 표시
- **드래그/스와이프 시작**: UI 자동 숨김
- **화면 탭/클릭**: UI 토글 (표시/숨김)
- **페이지 전환 후**: UI 숨김 상태 유지

#### 2.1.3 감상문 기능
| 기능 | 설명 |
|------|------|
| 전체화면 저장 | 현재 페이지를 PNG 이미지로 다운로드 |
| 감상문 쓰기 | 글쓰기 + 꾸미기(그리기/사진) 도구 |
| 감상문 보기 | 저장된 감상문 갤러리 |

#### 2.1.4 감상문 저장 정책
- **저장 위치**: localStorage (`bookclub3_reports` 키)
- **저장 형식**: JSON 배열 (base64 썸네일 포함)
- **데이터 항목**: id, bookName, title, bodyText, photos, drawingData, thumbnail, createdAt, updatedAt

#### 2.1.5 AI 버디 시스템 (읽기 동반자)

##### 기본 동작
| 항목 | 설명 |
|------|------|
| 목적 | 독서 집중도 유지 및 이탈 방지 |
| 진입 시나리오 | PDF 로딩 후 0.8초 후 읽기 목표 선택 팝업 표시 |
| 읽기 목표 | 조금만(5p), 보통(10p), 많이(20p), 끝까지(전체) |
| 미니메뉴 방식 | Pull-based: 사용자가 캐릭터 탭 시 메뉴 표시 |
| 메뉴 항목 | 잠깐 쉴래, 스트레칭!, 내 읽기 기록, 감상문 쓰기 |

##### 시선추적 기반 이탈감지 시스템
**전제**: 시선추적 기술을 활용한다고 가정
**gazeState**: onText(정상) / offScreen(화면밖) / wandering(방황) / fixed(고정멍) / drowsy(졸음)

| 시선 상태 | 1단계 | 2단계 | 3단계 |
|----------|-------|-------|-------|
| 화면밖 응시 | 10초: 말풍선 "이쪽이야~" | 25초: "다른 거 궁금해?" | 50초: 자동 북마크 |
| 시선 방황 | 15초: "재미있는 부분 찾고 있어?" | 35초: "그림이 있어!" | 55초: "천천히 읽어도 괜찮아" |
| 멍때리기 (고정) | 15초: "무슨 생각해?" | 40초: "어려워? 다시 읽어볼까?" | 80초: 자동 북마크 |
| 졸음 감지 | 5초: "눈이 감기고 있어!" | 12초: 스트레칭 가이드 | 22초: 쉬는시간 타이머 |

##### 졸음 방지 기능
| 기능 | 설명 |
|------|------|
| 스트레칭 가이드 | 3가지 동작 안내 오버레이 (팔 뻗기, 목 돌리기, 눈 깜빡이기) |
| 쉬는시간 타이머 | 60초 원형 프로그레스 타이머, 자동 복귀 또는 수동 종료 |
| 버디 상태 | reading(정상) / happy(목표달성) / sleepy(졸림) / stretch(스트레칭) |

##### 빠른 넘김 감지
- 3초 이내 연속 페이지 넘김 5회 이상 시 "어려워?" 메시지
- 뒤로 넘기기는 복습으로 판단하여 무시

##### 목표 달성 및 보상
| 상황 | 동작 |
|------|------|
| 목표 달성 | 컨페티 애니메이션 + "목표 달성!" 메시지 (5초) |
| 완독 | 컨페티 애니메이션 + "다 읽었다! 대단해!" 메시지 |
| 읽기 리포트 | 총 시간, 읽은 페이지, 집중 구간, 빠르게 넘긴 페이지, 평균 속도 |

##### 말풍선 타이머 정책
- **표시 시간**: 모든 말풍선 5초 통일
- **타이머 관리**: `showBubbleMsg` 헬퍼 함수로 이전 타이머 자동 clear
- **중복 방지**: 연속 클릭 시에도 정확히 5초 유지
- **수동 닫기**: 캐릭터 탭 시 즉시 닫기 또는 ✕ 버튼

##### 캐릭터 디자인
| 항목 | 사양 |
|------|------|
| 크기 | 90px (viewBox 0 0 100 100) |
| 위치 | 우측 하단 (bottom: 7rem, right: 1rem) |
| 그림자 | drop-shadow(0 4px 12px rgba(0,0,0,0.15)) |
| 호버 효과 | 메뉴 열릴 때 scale(1.1) |
| 그라데이션 | 몸통/배/꼬리에 radialGradient 적용 |
| 특수 효과 | 바닥 그림자, 볼터치 2겹, 꼬리 3층 구조 |

##### 테스트 패널
- 좌상단 "● 테스트 모드" 버튼
- 버디 상태 전환 (4가지: reading/happy/sleepy/stretch)
- 시선추적 상태 실시간 전환 (5가지)
- 시나리오별 3단계 즉시 재생
- 실시간 데이터 모니터링 (시선상태, 이탈단계, 페이지 체류시간 등)

## 3. 공통 정책

### 3.1 좌표계
- 모든 위치값은 **퍼센트(%)** 기반으로 저장
- 반응형 레이아웃 대응

### 3.2 HiDPI 대응
- Canvas 렌더링 시 `devicePixelRatio` 적용
- 물리 픽셀 기준 렌더링 후 CSS로 논리 크기 조정

### 3.3 성능 최적화
| 항목 | 방법 |
|------|------|
| PDF 렌더링 | 현재 페이지만 렌더링, 이전 태스크 취소 |
| 이미지 저장 | 썸네일 별도 생성 (품질 0.15) |
| Canvas 히스토리 | 최대 30개 유지, 초과 시 오래된 것 삭제 |

### 3.5 메시지 표시 정책
- **말풍선 메시지**: 5초 표시 후 자동 사라짐 (일괄 통일)
- **오버레이**: 사용자가 닫기 버튼 클릭 시까지 유지
- **탭 시 즉시 닫기**: 말풍선 표시 중 캐릭터 탭 시 즉시 닫기

### 3.4 애니메이션
| 애니메이션 | 용도 | 시간 |
|----------|------|------|
| buddy-enter | AI 버디 캐릭터 진입 | 0.5초 |
| bubble-in | 말풍선 나타남 | 0.3초 |
| slide-up | 오버레이 슬라이드 업 | 0.4초 |
| buddy-bounce | 캐릭터 통통 튀기 (excited) | 2초 반복 |
| anim-float | 캐릭터 부유 (sleepy) | 3초 반복 |
| tail-wag | 꼬리 흔들기 (excited) | 0.4초 반복 |
| confetti-fall | 컨페티 떨어짐 (목표달성) | 3초 |

### 3.6 접근성
- 터치 타겟 최소 44x44px 권장
- 색상 대비 준수 (텍스트/배경)
- 키보드 네비게이션 지원 (도서 뷰어)

---

## 4. 데이터 구조

### 4.1 감상문 (Report)
```javascript
{
  id: string,           // 고유 ID (timestamp + random)
  bookName: string,     // 도서명
  title: string,        // 감상문 제목
  bodyText: string,     // 본문 텍스트
  photos: [             // 첨부 사진 배열
    {
      id: string,
      src: string,      // base64 data URL
      x: number,        // 위치 % (0-100)
      y: number,
      w: number,        // 크기 % (0-100)
      h: number
    }
  ],
  drawingData: string,  // 캔버스 그리기 데이터 (base64)
  thumbnail: string,    // 썸네일 (base64, 저품질)
  createdAt: string,    // ISO 8601
  updatedAt: string     // ISO 8601
}
```


## 5. 버전 히스토리

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v0.1 | 2025-02-06 | 초기 프로토타입 릴리즈 |
| v0.2 | 2025-02-06 | 샘플 PDF 도서 추가, 파일 구조 정리 |
| v0.2 (업데이트) | 2025-02-10 | AI 버디 시스템 대폭 개선 |
|  |  | - 시선추적 기반 이탈감지 시스템 구현 (4가지 상태 × 3단계) |
|  |  | - 졸음방지 기능 추가 (스트레칭 가이드, 쉬는시간 타이머) |
|  |  | - 퀴즈 기능 제거 (집중도 방해 요소 제거) |
|  |  | - 말풍선 메시지 표시 시간 5초로 통일 |
|  |  | - 테스트 패널 완전 재설계 (시선상태 실시간 전환) |
|  |  | - 말풍선 타이머 일관성 개선 (showBubbleMsg 헬퍼) |
|  |  | - 캐릭터 크기 확대 및 디자인 업그레이드 (70→90, 그라데이션/그림자) |
| v0.3 | 2025-02-10 | 독서 전용 뷰어로 분리 |
|  |  | - 영상뷰어, 놀이학습 기능 제거 |
|  |  | - PDF 도서뷰어 + AI 버디 시스템만 유지 |
|  |  | - 파일명: 북클럽3.0_독서뷰어_v0.3.html |
|  |  | - 코드 라인 약 45% 감소 (3443 → 1914줄) |

---

## 6. 향후 계획

### 6.1 단기 (v0.4)
- [ ] 실제 시선추적 하드웨어 연동 (아이트래커 API)
- [ ] 오프라인 저장 (IndexedDB)
- [ ] 독서 이력 통계 대시보드
- [ ] 북마크 자동 저장 기능

### 6.2 중기 (v1.0)
- [ ] 서버 연동 (감상문 동기화)
- [ ] 학습 진도 추적
- [ ] 다국어 지원
- [ ] AI 버디 개인화 (사용자별 패턴 학습)

### 6.3 장기
- [ ] AI 기반 학습 피드백
- [ ] 음성 인식 연동
- [ ] 학부모/교사 대시보드
- [ ] 독서 집중도 분석 리포트

---

## 7. 파일 구조

```
북클럽3.0_통합뷰어/
├── prototype/
│   ├── 북클럽3.0_통합뷰어_v0.1.html         # v0.1 뷰어
│   ├── 북클럽3.0_통합뷰어_v0.2.html         # v0.2 뷰어 (최신)
│   ├── 북클럽3.0_통합뷰어_정책문서_v0.1.md  # v0.1 정책문서
│   └── 북클럽3.0_통합뷰어_정책문서_v0.2.md  # v0.2 정책문서 (본 문서)
├── 샘플도서/
│   └── 9789814983754_Scholastic_3 Cats.pdf  # 샘플 PDF 도서
└── README.md
```

---

## 8. 연락처

- **저장소 (GitHub)**: https://github.com/g10016775-cpu/junghwan
- **저장소 (WJTB)**: https://git.wjtb.kr/ai-labs/bookclub30/bc3_int_viewer
