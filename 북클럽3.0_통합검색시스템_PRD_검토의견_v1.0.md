# 북클럽 3.0 통합검색 시스템 PRD 검토 의견

**검토일**: 2025-02-10
**검토자**: Claude (Technical Reviewer)
**문서 버전**: v1.0

---

## 📊 전체 평가

| 항목 | 평가 | 점수 |
|------|------|------|
| **비즈니스 가치** | 매우 높음 | ⭐⭐⭐⭐⭐ |
| **기술 실현 가능성** | 높음 | ⭐⭐⭐⭐ |
| **문서 완성도** | 우수 | ⭐⭐⭐⭐ |
| **리스크 관리** | 양호 | ⭐⭐⭐⭐ |

**종합 의견**:
명확한 비즈니스 문제 정의와 실행 가능한 기술 솔루션을 제시한 우수한 PRD입니다. 다만 일부 구현 세부사항과 정책 결정이 필요한 영역이 있어 보완이 필요합니다.

---

## ✅ 강점 (Strengths)

### 1. 명확한 문제 정의
- ✅ As-Is/To-Be 비교가 직관적
- ✅ "Game Changer" 개념으로 핵심 가치 명확화
- ✅ 정량적 목표 설정 (99.9% 개선율 등)

### 2. 실행 가능한 기술 아키텍처
- ✅ AWS OpenSearch 선정 근거 합리적
- ✅ Event-Driven 아키텍처 적용 적절
- ✅ 보안 및 모니터링 고려

### 3. 단계별 구현 계획
- ✅ MVP → 고도화 → 최적화 3단계 구조
- ✅ 우선순위 명확 (P0/P1/P2)
- ✅ 현실적인 일정 (4개월)

---

## ⚠️ 개선 필요 사항 (Critical Issues)

### 1. 검색 노출 정책 미정의 ⚠️ HIGH

**문제점:**
```
"관리자 페이지 내 '검색 노출 여부' 플래그를 별도 신설"
```
- 이 플래그의 **기본값**이 명시되지 않음
- **누가, 언제, 왜** 이 플래그를 변경하는지 프로세스 누락
- 자동화 규칙이 없으면 운영 부담 증가

**제안:**
```markdown
### 검색 노출 정책 (신규 추가 필요)

#### 기본 노출 조건
- BCMS에 자재 등록 시 `is_searchable = TRUE` (기본값)
- 단, 다음 조건 충족 필요:
  - 메타데이터 완성도 > 80% (제목, 저자, 표지, 설명)
  - 심의 등급 확정
  - 저작권 상태 = '정상'

#### 자동 비노출 조건
- 판매 중단 도서 (30일 후 자동 OFF)
- 신고 누적 3회 이상
- 품질 점수 < 60점

#### 수동 관리 권한
- 역할: 콘텐츠 관리자, 서비스 운영자
- 로그 기록: 변경 시점, 변경자, 사유
```

---

### 2. KRS 레벨 부스팅 알고리즘 불명확 ⚠️ MEDIUM

**문제점:**
```json
"weight": 2.0  // 왜 2.0인가?
"weight": 1.5  // 왜 1.5인가?
```
- 가중치 값의 **근거** 부재
- **실험 계획** 없음 (A/B 테스트?)
- 사용자별 차이 고려 필요 (연령대별 변동성)

**제안:**
```markdown
### KRS 부스팅 전략 (수정안)

#### 초기값 (Baseline)
- 정확히 일치: 2.0x
- ±1 레벨: 1.5x
- ±2 레벨: 1.2x
- 그 외: 1.0x (부스팅 없음)

#### 실험 프로토콜
- A/B 테스트 기간: 2주
- 측정 지표:
  - 검색 후 클릭률 (CTR)
  - 검색 후 콘텐츠 소비 시간
  - 사용자 만족도 설문 (5점 척도)
- 가중치 조정 주기: 월 1회

#### 예외 처리
- KRS 미측정 사용자: 연령 기반 추정 레벨 적용
- 신규 가입 사용자: 부스팅 없음 (데이터 수집 우선)
```

---

### 3. 인덱싱 파이프라인 장애 시나리오 누락 ⚠️ HIGH

**문제점:**
- Kafka 장애 시 대응 방안 불명확
- 인덱싱 실패 시 **재시도 정책** 미정의
- **Dead Letter Queue** 언급 없음

**제안:**
```markdown
### 인덱싱 장애 대응 (신규 추가)

#### 재시도 정책
1. 즉시 재시도: 1회 (네트워크 순간 장애)
2. 지수 백오프: 1분, 5분, 15분 후 재시도
3. 최종 실패: DLQ로 전송

#### Dead Letter Queue (DLQ)
- 3회 재시도 실패 시 DLQ로 이동
- 알림: Slack + 이메일 (즉시)
- 수동 처리: 관리자 대시보드에서 재처리 버튼

#### Fallback: 배치 인덱싱
- 실시간 파이프라인 장애 시 자동 전환
- 주기: 5분 (긴급) / 1시간 (일반)
- 복구 시 자동 원복

#### 모니터링
- DLQ 메시지 수 > 10: 🔴 Critical 알람
- 인덱싱 지연 > 5분: 🟡 Warning
```

---

### 4. 성능 목표 및 부하 테스트 계획 누락 ⚠️ MEDIUM

**문제점:**
- "응답 시간 < 300ms"만 명시, **동시 사용자 수** 기준 없음
- **부하 테스트 시나리오** 미정의
- 트래픽 급증 시 대응 전략 부재

**제안:**
```markdown
### 성능 요구사항 (구체화)

#### 응답 시간 (Response Time)
| 시나리오 | 동시 사용자 | 목표 (p95) | 최대 허용 |
|---------|-----------|----------|----------|
| 일반 검색 | 100 | 200ms | 500ms |
| 일반 검색 | 1,000 | 300ms | 800ms |
| 자동완성 | 100 | 50ms | 150ms |
| 필터 적용 | 100 | 300ms | 1,000ms |

#### 처리량 (Throughput)
- 초당 검색 요청: 500 QPS (일반) / 2,000 QPS (피크)
- 초당 인덱싱: 100 docs/s (일반) / 500 docs/s (배치)

#### 부하 테스트 계획
**Phase 1: 기능 테스트** (개발 완료 후)
- 목표: 단일 사용자 기능 검증
- 도구: Postman / Jest

**Phase 2: 부하 테스트** (배포 1주 전)
- 목표: 예상 트래픽의 2배 부하 견딤
- 도구: Apache JMeter / k6
- 시나리오:
  - Ramp-up: 0 → 1,000 사용자 (10분)
  - Sustained: 1,000 사용자 유지 (30분)
  - Spike: 1,000 → 3,000 사용자 (5분)

**Phase 3: Soak 테스트** (배포 3일 전)
- 목표: 장시간 안정성 검증
- 기간: 24시간
- 모니터링: 메모리 누수, CPU 사용률
```

---

## 🤔 명확화 필요 사항 (Clarifications Needed)

### 1. "확장 메타데이터" 범위 불명확

**질문:**
```
"감상문 키워드, AI 태그, 본문 OCR 포함"
```
- **감상문 키워드**: 사용자 작성 감상문에서 추출? 어떤 알고리즘?
- **AI 태그**: GPT-4 Vision의 **프롬프트** 설계는?
- **본문 OCR**: "샘플 페이지 3장"은 어떻게 선정? (첫 3장? 랜덤?)

**제안:**
```markdown
### 확장 메타데이터 정의 (상세화)

#### 1. 감상문 키워드
- 출처: 사용자 작성 감상문 중 '공개' 설정된 것만
- 추출: TF-IDF 기반 상위 10개 키워드
- 갱신: 새 감상문 작성 시 실시간 업데이트

#### 2. AI 태그
- 모델: GPT-4 Vision (gpt-4-vision-preview)
- 입력: 도서 표지 + 샘플 페이지 1장
- 프롬프트:
  ```
  이 아동 도서의 내용을 분석하여 다음 정보를 JSON으로 추출하세요:
  - 주요 테마 (최대 3개)
  - 등장 캐릭터 (최대 5개)
  - 감정 키워드 (최대 3개)
  - 적합 연령대
  ```
- 갱신: 신규 자재 등록 시 1회 (비용 고려)

#### 3. 본문 OCR
- 대상 페이지: 1, 중간, 마지막 페이지 (3장)
- OCR 엔진: AWS Textract (한국어 지원)
- 인덱싱: 형태소 분석 후 명사만 추출
- 용도: "책 속 단어 검색" 기능
```

---

### 2. "동의어 관리" 구체적 사례 부족

**질문:**
- 동의어 예시가 없어 범위 판단 어려움
- 자동 동의어 생성 vs 수동 관리?

**제안:**
```markdown
### 동의어 사전 관리

#### 유형별 예시

**1. 도서명 변형**
- "신비한 아파트" ↔ "신비아파트"
- "언더독스" ↔ "언더독"

**2. 캐릭터명**
- "또봇" ↔ "로봇 또봇"
- "타요" ↔ "꼬마버스 타요"

**3. 장르 별칭**
- "위인전" ↔ "위인 이야기" ↔ "인물 동화"
- "공룡책" ↔ "공룡 도감"

**4. 속어/은어**
- "공쥬" ↔ "공주"
- "쵸콜릿" ↔ "초콜릿"

#### 관리 프로세스
- **자동 추천**: 검색 로그 분석 → 빈도 높은 변형 제안
- **수동 등록**: 관리자가 직접 추가
- **주기적 리뷰**: 월 1회 동의어 효과 분석
```

---

### 3. "제로 결과" 시 추천 로직 모호

**질문:**
```
"KRS 레벨 ±1 범위 인기 도서"
```
- 인기 기준은? (조회수? 감상문 수? 평점?)
- 몇 권 노출? (3권? 5권? 10권?)
- 정렬 순서는?

**제안:**
```markdown
### 제로 결과 대응 상세 로직

#### 1차: 검색어 확장
- 오타 교정 적용 (Edit Distance 3까지)
- 형태소 분석하여 부분 매칭
- 예: "신비 아파트" 검색 → "신비아파트" 결과 표시

#### 2차: 관련 도서 추천
**추천 기준 (우선순위 순):**
1. **KRS 매칭**: 사용자 레벨 ±1
2. **인기도**: 최근 30일 조회수 상위
3. **신규성**: 최근 7일 내 등록
4. **평점**: 4.0점 이상

**노출 개수**: 6권
**레이아웃**: 2행 3열 그리드

#### UI 문구
```
"신비아파토"에 대한 검색 결과가 없습니다. 😢

혹시 이 도서를 찾으셨나요?
→ [신비아파트] 시리즈 3권 [정확도 95%]

또는 이런 도서는 어떠세요? (우리 아이 수준에 맞춰요!)
[도서 썸네일 6개]
```
```

---

## 💡 추가 제안 사항 (Enhancements)

### 1. 검색어 자동완성 고도화

**현재 PRD:**
> "초성 검색 및 오타 교정"

**추가 제안:**
```markdown
### 자동완성 고도화 전략

#### 1. 개인화 자동완성
- 사용자의 **최근 검색어** 우선 표시 (상위 3개)
- 사용자의 **즐겨찾기** 시리즈 우선 표시
- 예:
  ```
  입력: "또"
  결과:
    🕒 또봇 (최근 검색)
    ⭐ 또래 친구들 (내 서재)
    📚 또는 (인기 검색어)
  ```

#### 2. 컨텍스트 인식
- 시간대별 추천 (예: 저녁 → "잠자리 동화")
- 요일별 추천 (예: 주말 → "긴 이야기책")

#### 3. 트렌딩 표시
- 급상승 검색어 🔥 아이콘
- 신규 도서 🆕 배지
```

---

### 2. 검색 분석 대시보드 확장

**현재 PRD:**
> "실시간 검색어, 검색 실패어"

**추가 제안:**
```markdown
### 검색 분석 대시보드 추가 지표

#### 사용자 행동 분석
1. **검색 → 클릭 전환율**
   - 검색 후 결과 클릭 비율
   - 클릭 위치 분포 (1위 vs 2-5위 vs 6-10위)

2. **검색 → 콘텐츠 소비 전환율**
   - 검색 → 상세 → 읽기 시작 비율
   - 평균 소요 시간 (검색 → 읽기 시작)

3. **재검색률**
   - 5분 내 동일 검색어 반복 비율
   - → 검색 결과 불만족 지표

#### 콘텐츠 성과 분석
1. **검색 유입 도서 순위**
   - 검색으로 가장 많이 발견되는 도서 Top 20

2. **숨은 보석 발굴**
   - 검색 유입 대비 높은 만족도 도서
   - → 프로모션 대상 선정

#### 운영 효율성
1. **검색 품질 점수**
   - (검색 성공률 × 0.4) + (평균 클릭 위치 × 0.3) + (전환율 × 0.3)
   - 주간/월간 트렌드 추적
```

---

### 3. 접근성 (Accessibility) 고려

**현재 PRD에서 누락된 부분:**

```markdown
### 접근성 개선 사항

#### 1. 음성 검색 지원
- 모바일: 마이크 버튼 → STT (Speech-to-Text)
- 특히 유용한 사용자:
  - 한글 입력 미숙한 저학년
  - 부모가 대신 검색하는 경우

#### 2. 검색 결과 읽기 모드
- TTS (Text-to-Speech)로 검색 결과 읽어주기
- 시각 장애 사용자 지원

#### 3. 고대비 모드
- 검색 UI 고대비 버전 제공
- 저시력 사용자 배려

#### 4. 키보드 네비게이션
- Tab / Shift+Tab: 결과 이동
- Enter: 선택
- Esc: 검색창 닫기
```

---

## 🔴 Critical Path (병목 지점)

### 1. BCMS DB 스키마 확정 ⏰ 즉시 필요

**이슈:**
- 인덱싱 대상 필드가 PRD에 명시되지 않음
- BCMS 팀과 사전 협의 필요

**필요한 정보:**
```sql
-- 예상 스키마 (확인 필요)
SELECT
  asset_id,
  title,
  author,
  publisher,
  isbn,
  description,
  cover_image_url,
  krs_level,
  age_range_min,
  age_range_max,
  genre,
  series_name,
  publication_date,
  is_active,        -- ❓ 필드명 확인 필요
  is_searchable,    -- ❓ 신규 추가 필드
  created_at,
  updated_at
FROM assets
WHERE deleted_at IS NULL;
```

**Action Item:**
- [ ] BCMS 팀 미팅 일정 수립
- [ ] 인덱싱 필요 필드 목록 확정
- [ ] `is_searchable` 컬럼 추가 요청

---

### 2. Kafka 인프라 결정 ⏰ 1주 내

**이슈:**
- AWS MSK vs Self-hosted Kafka 결정 필요
- 비용 vs 운영 복잡도 트레이드오프

**비교표:**
| 항목 | AWS MSK | Self-hosted (EC2) |
|------|---------|------------------|
| 초기 구축 | 빠름 (1일) | 느림 (1주) |
| 월 비용 | $200-500 | $100-200 |
| 운영 난이도 | 낮음 | 높음 |
| 커스터마이징 | 제한적 | 자유로움 |
| **권장** | ✅ 초기 MVP | Phase 3 이후 검토 |

**Action Item:**
- [ ] 예상 메시지 볼륨 산정
- [ ] MSK vs EC2 비용 시뮬레이션
- [ ] 기술 스택 최종 결정

---

### 3. KRS 레벨 데이터 품질 검증 ⏰ 2주 내

**이슈:**
- KRS 레벨이 **모든 사용자**에게 할당되어 있는가?
- 레벨 갱신 주기는? (일? 주? 월?)

**확인 필요:**
```sql
-- KRS 레벨 커버리지 확인
SELECT
  COUNT(*) as total_users,
  COUNT(krs_level) as users_with_krs,
  ROUND(COUNT(krs_level) * 100.0 / COUNT(*), 2) as coverage_pct
FROM users
WHERE status = 'ACTIVE';

-- 레벨 분포 확인
SELECT
  krs_level,
  COUNT(*) as user_count
FROM users
WHERE krs_level IS NOT NULL
GROUP BY krs_level
ORDER BY krs_level;
```

**예상 이슈:**
- 신규 가입 사용자: KRS 미측정 → 검색 부스팅 불가
- 장기 미이용 사용자: 레벨 구식화 → 부정확한 추천

**대응 방안:**
- KRS 없는 사용자: 나이 기반 추정 레벨 임시 부여
- 레벨 갱신 주기: 최소 월 1회 (이상적으로는 주 1회)

---

## 📋 체크리스트: 개발 착수 전 필수 확인 사항

### 비즈니스 정책
- [ ] 검색 노출 기본 정책 확정
- [ ] KRS 부스팅 가중치 초기값 결정
- [ ] 제로 결과 시 추천 기준 합의
- [ ] 동의어 사전 초기 데이터 준비 (최소 100개)

### 기술 스펙
- [ ] BCMS DB 스키마 확정 및 접근 권한 확보
- [ ] OpenSearch 클러스터 사이징 (노드 수, 인스턴스 타입)
- [ ] Kafka 인프라 선택 (MSK vs EC2)
- [ ] API 스펙 문서 작성 (OpenAPI 3.0)

### 운영 준비
- [ ] 관리자 페이지 화면 설계 (Figma/Sketch)
- [ ] 검색 노출 관리 가이드 초안
- [ ] 장애 대응 Runbook 초안
- [ ] 모니터링 대시보드 설계

### 조직 협업
- [ ] BCMS 팀 협업 프로세스 정의
- [ ] 인프라팀 리소스 확보
- [ ] QA 팀 테스트 시나리오 공유
- [ ] CS 팀 대응 매뉴얼 제공

---

## 🎯 최종 권장사항

### Immediate Actions (즉시 실행)

1. **PoC 진행** (1주)
   - OpenSearch 샘플 클러스터 구축
   - 1,000건 데이터로 검색 정확도 검증
   - Nori 형태소 분석기 한국어 성능 테스트

2. **정책 확정 회의** (2주 내)
   - 참석자: 서비스 기획, 운영, 개발, BCMS 팀
   - 안건: 검색 노출 정책, KRS 부스팅 전략
   - 산출물: 정책 문서 v1.0

3. **상세 설계** (3주 내)
   - API 스펙 문서
   - 인덱싱 파이프라인 상세 설계
   - 데이터 모델 (인덱스 스키마)

### Short-term Goals (1개월 내)

- [ ] 기술 스택 최종 결정
- [ ] MVP 범위 재확인
- [ ] 개발 환경 구축 완료
- [ ] Sprint 계획 수립

### Long-term Success Factors

1. **데이터 품질 관리**
   - 메타데이터 완성도 모니터링
   - 정기적 데이터 클렌징

2. **지속적 최적화**
   - A/B 테스트 문화 정착
   - 사용자 피드백 수집 체계

3. **팀 역량 강화**
   - OpenSearch 내부 교육
   - 검색 품질 평가 역량

---

## 📝 다음 리뷰 안건

**예정일**: 2025-02-15
**형식**: 기술 리뷰 미팅 (2시간)

**Agenda:**
1. PoC 결과 공유 (30분)
2. 정책 확정 사항 리뷰 (30분)
3. 상세 설계 발표 (40분)
4. Q&A 및 리스크 논의 (20분)

**준비 자료:**
- PoC 테스트 리포트
- 정책 문서 v1.0
- API 스펙 초안
- 인덱스 스키마 설계

---

**검토 결론**: ✅ **조건부 승인**

PRD는 전반적으로 우수하나, 다음 항목 보완 후 개발 착수 권장:
1. 검색 노출 정책 상세화
2. 장애 대응 시나리오 추가
3. BCMS 팀과 스키마 확정
4. PoC를 통한 기술 검증

**예상 개발 일정**: PoC 완료 후 8주 (MVP 기준)
